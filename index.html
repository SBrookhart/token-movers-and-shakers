
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Token Movers â€” Microcaps & Majors</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="Daily token movers: top gainers and losers among tiny microcaps (<$50M) and major players (Topâ€‘100). Includes methodology and data sources." />
<style>
  :root {
    --bg:#0b0f14; --card:#111827; --border:#1f2937; --text:#e5e7eb; --muted:#94a3b8;
    --green:#22c55e; --red:#ef4444; --accent:#243041; --tab:#0f1620; --yellow:#fbbf24;
    --chip:#0e1724; --chip-ok:#113e22; --chip-err:#5a1313;
  }
  * { box-sizing:border-box }
  body { background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; padding:22px; }
  h1 { text-align:center; margin:0 0 6px; }
  .meta { text-align:center; color:var(--muted); margin-bottom:12px; }
  .topbar { max-width:1100px; margin:0 auto 12px; display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:center; }
  .topbar input { background:#0f1620; color:#e5e7eb; border:1px solid #1f2937; border-radius:8px; padding:6px 10px; min-width:260px; }
  .topbar button { background:#1f2937; color:var(--text); border:1px solid var(--border); padding:6px 10px; border-radius:8px; cursor:pointer; }
  .topbar button:hover { background:var(--accent); }
  .banner { max-width:1100px; margin:0 auto 14px; background:#0f1620; border:1px solid var(--border); border-radius:10px; padding:10px 12px; color:#d1d5db; }
  .tabs { max-width:1100px; margin:0 auto 10px; display:flex; gap:8px; }
  .tab { background:var(--tab); border:1px solid var(--border); color:#cbd5e1; padding:8px 12px; border-radius:10px; cursor:pointer; }
  .tab.active { background:#1a2230; color:#fff; border-color:#2b3a51; }
  .panel { display:none; } .panel.active { display:block; }
  .two { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:10px; }
  .card { background:var(--card); border:1px solid var(--border); padding:12px; border-radius:12px; }
  .card h3 { margin:4px 0 10px; display:flex; align-items:center; gap:10px; }
  .chip { font-size:.75rem; background:var(--chip); border:1px solid #22324a; color:#cbd5e1; padding:2px 8px; border-radius:999px; }
  .chip.ok{ background:var(--chip-ok); border-color:#1d6830; color:#d1fae5 }
  .chip.err{ background:var(--chip-err); border-color:#8b1a1a; color:#fecaca }
  .list { display:grid; gap:6px; }
  .row { display:grid; grid-template-columns:24px 1fr 100px 120px 90px; gap:8px; align-items:center; padding:8px; border:1px solid #1f2937; border-radius:8px; background:#0f1620; }
  .row img { width:24px; height:24px; border-radius:50%; display:block; }
  .row .name { display:flex; gap:6px; align-items:baseline; }
  .row .name a { color:#e5e7eb; text-decoration:none; } .row .name a:hover { text-decoration:underline; }
  .row .name .sym { color:#9ca3af; font-size:.9rem; }
  .chg { font-weight:600; text-align:right; }
  .pos { color:var(--green); } .neg { color:#ef4444; }
  details { background:#0f1620; border:1px solid var(--border); border-radius:10px; padding:10px 12px; max-width:1100px; margin:14px auto; }
  details summary { cursor:pointer; font-weight:600; }
  .muted { color:var(--muted); }
  .refs a { color:#93c5fd; text-decoration:underline; }
  details.debug { max-width:1100px; margin:14px auto; background:#0f1620; border:1px solid var(--border); border-radius:10px; padding:8px 12px; }
  .log { white-space:pre-wrap; font-family:ui-monospace, Menlo, Consolas, monospace; font-size:12px; color:#cbd5e1; max-height:220px; overflow:auto; background:#0b1119; border:1px solid #1f2937; border-radius:8px; padding:8px; }
  @media (max-width: 760px) {.two { grid-template-columns:1fr; } .row { grid-template-columns:24px 1fr 90px 100px 80px; }}
</style>
</head>
<body>
  <h1>ðŸ“ˆ Token Movers â€” Microcaps & Majors</h1>
  <div class="meta">
    <span id="updated">Loadingâ€¦</span> Â· Autoâ€‘refresh every 60s Â· <button id="refreshBtn">Refresh</button>
  </div>

  <div class="banner">
    <h2 style="margin:0 0 6px">What youâ€™re seeing</h2>
    <p>
      Dayâ€™s <strong>top gainers and losers</strong> by <em>24â€‘hour % change</em> for:
      <strong>Tiny Microcaps</strong> (market cap &lt; <strong>$50M</strong>) and <strong>Major Players</strong> (Topâ€‘100).
      Use the search box to filter. Refreshes every minute.
    </p>
    <p class="muted">Small caps can be noisy; verify liquidity/listings before acting.</p>
  </div>

  <div class="topbar">
    <input id="search" type="text" placeholder="Search name or symbolâ€¦" />
    <input id="cgKey" type="password" placeholder="(Optional) CoinGecko Demo API key" />
    <button id="saveKey">Save key</button>
    <button id="clearKey">Clear key</button>
    <span id="keyStatus" style="color:#fbbf24;"></span>
  </div>

  <div class="tabs">
    <div class="tab active" data-tab="micro">Microcaps (&lt;$50M)</div>
    <div class="tab" data-tab="majors">Major Players (Topâ€‘100)</div>
  </div>

  <div id="panel-micro" class="panel active">
    <div class="two">
      <div class="card">
        <h3>Top 15 Gainers (24h) <span id="micro-src1" class="chip">loadingâ€¦</span></h3>
        <div id="micro-gainers" class="list"></div>
      </div>
      <div class="card">
        <h3>Top 15 Losers (24h) <span id="micro-src2" class="chip">loadingâ€¦</span></h3>
        <div id="micro-losers" class="list"></div>
      </div>
    </div>
  </div>

  <div id="panel-majors" class="panel">
    <div class="two">
      <div class="card">
        <h3>Top 15 Gainers (24h) <span id="majors-src1" class="chip">loadingâ€¦</span></h3>
        <div id="majors-gainers" class="list"></div>
      </div>
      <div class="card">
        <h3>Top 15 Losers (24h) <span id="majors-src2" class="chip">loadingâ€¦</span></h3>
        <div id="majors-losers" class="list"></div>
      </div>
    </div>
  </div>

  <details open>
    <summary>ðŸ“š Methodology & Data Sources</summary>
    <div style="margin-top:8px; line-height:1.5">
      <ol>
        <li><strong>Segments.</strong> Microcaps = market cap &lt; $50,000,000. Majors = Topâ€‘100 by market cap.</li>
        <li><strong>Primary source.</strong> CoinGecko <code>/api/v3/coins/markets</code> (price, cap, 24h %, logo). Demo key improves reliability (~30 calls/min). [8](https://info.etherscan.com/api-keys/)[2](https://etherscan.co.com/blog/api-key-setup-on-etherscan.php)</li>
        <li><strong>Fallbacks.</strong> CoinCap v2 <code>/v2/assets</code> (single list; supports large limits), CoinPaprika <code>/v1/tickers?quotes=USD</code>. [7](https://polygon-gas-station.vercel.app/about)[3](https://docs.base.org/base-account/reference/core/provider-rpc-methods/eth_gasPrice)</li>
      </ol>
    </div>
  </details>

  <details class="debug"><summary>ðŸ›  Debug (optional)</summary><div id="debugLog" class="log">No logs yet.</div></details>

<script>
/* ---------- Debug logger ---------- */
const LOG = document.getElementById('debugLog');
function dlog(...a){ LOG.textContent += `\n${new Date().toLocaleTimeString()}  ${a.map(x=>typeof x==='object'?JSON.stringify(x):String(x)).join(' ')}`; LOG.scrollTop = LOG.scrollHeight; }

/* ---------- Tabs ---------- */
document.querySelectorAll('.tab').forEach(t=>{
  t.addEventListener('click',()=> {
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.panel').forEach(x=>x.classList.remove('active'));
    t.classList.add('active'); document.getElementById('panel-'+t.dataset.tab).classList.add('active');
  });
});

/* ---------- Key storage (+ URL capture ?ck=...) ---------- */
const LS_KEY='CG_DEMO_KEY', keyInput=document.getElementById('cgKey'), keyStatus=document.getElementById('keyStatus');
function getCgKey(){ return (localStorage.getItem(LS_KEY)||'').trim(); }
function mask(k){ return k? k.slice(0,4)+'â€¢â€¢â€¢'+k.slice(-2):''; }
function updateKeyUI(){ const k=getCgKey(); keyStatus.textContent = k? `CoinGecko key saved (${mask(k)})` : 'No CoinGecko key (fallbacks enabled)'; }
(function capture(){ const p=new URLSearchParams(location.search); const ck=(p.get('ck')||'').trim(); if(ck && ck.length>10){ localStorage.setItem(LS_KEY, ck); history.replaceState({},'',location.pathname); dlog('Captured CG key via URL:', mask(ck)); }})(); updateKeyUI();
document.getElementById('saveKey').onclick=()=>{ const k=keyInput.value.trim(); if(!k){alert('Paste your CoinGecko Demo key first'); return;} localStorage.setItem(LS_KEY,k); keyInput.value=''; updateKeyUI(); initLoad(); };
document.getElementById('clearKey').onclick=()=>{ localStorage.removeItem(LS_KEY); updateKeyUI(); initLoad(); };

/* ---------- Search ---------- */
const searchInput=document.getElementById('search'); let cache={ micro:[], majors:[] }; searchInput.addEventListener('input', ()=> renderAll(cache));

/* ---------- Formatting helpers ---------- */
function fmtUSD(x){ if(x==null) return 'â€”'; const n=Number(x); if(n>=1) return '$'+n.toLocaleString(undefined,{maximumFractionDigits:2}); return '$'+n.toFixed(6); }
function fmtCap(x){ if(x==null) return 'â€”'; const n=Number(x); if(n>=1e9) return '$'+(n/1e9).toFixed(2)+'B'; if(n>=1e6) return '$'+(n/1e6).toFixed(2)+'M'; return '$'+Math.round(n).toLocaleString(); }
function byDesc(a,b){ return (b.pct24??-Infinity)-(a.pct24??-Infinity); }
function byAsc(a,b){ return (a.pct24??Infinity)-(b.pct24??Infinity); }
function esc(s){ return String(s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }
function rowHTML(c){
  const img = c.img ? `${esc(c.img)}` : 'ðŸª™';
  return `
    <div class="row">
      <div>${img}</div>
      <div class="name">
        ${esc(c.link)}${esc(c.name)}</a>
        <span class="sym">${esc(c.symbol)}</span>
      </div>
      <div>${fmtUSD(c.price)}</div>
      <div>${fmtCap(c.cap)}</div>
      <div class="chg ${c.pct24>=0?'pos':'neg'}">${(c.pct24??0).toFixed(2)}%</div>
    </div>`;
}
function renderList(id, rows){
  const q=(searchInput.value||'').trim().toLowerCase();
  const f = q? rows.filter(c=>c.name.toLowerCase().includes(q)||c.symbol.toLowerCase().includes(q)) : rows;
  document.getElementById(id).innerHTML = f.map(rowHTML).join('');
}
function renderAll(d){
  cache=d;
  renderList('micro-gainers', [...d.micro].sort(byDesc).slice(0,15));
  renderList('micro-losers',  [...d.micro].sort(byAsc).slice(0,15));
  renderList('majors-gainers', [...d.majors].sort(byDesc).slice(0,15));
  renderList('majors-losers',  [...d.majors].sort(byAsc).slice(0,15));
}

/* ---------- CORSâ€‘safe fetch (original + proxy rotation) ---------- */
const PROXIES = [
  u => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,   // adds CORS headers; returns raw body
  u => `https://cors.isomorphic-git.org/${u}`,                        // simple forward proxy
  u => `https://corsproxy.io/?${encodeURIComponent(u)}`               // adds CORS + caching
]; // Sources discuss CORS and proxy strategies. [4](https://docs.tatum.io/reference/rpc-solana-getrecentprioritizationfees)[5](https://docs.tenderly.co/node/rpc-reference/polygon-mainnet/tenderly_gasPrice)[6](https://github.com/RegoDefies/Polygon-Docs/blob/master/develop/tools/matic-gas-station.md)

async function getJSON(url, opt={}, timeoutMs=9000){
  // 1) try direct
  try { const r = await fetchWithTimeout(url,opt,timeoutMs); return await r.json(); }
  catch(e){ dlog('direct failed ->', url, e.message||e); }

  // 2) try proxies in order
  for (const wrap of PROXIES){
    const prox = wrap(url);
    try { dlog('proxy try ->', prox); const r=await fetchWithTimeout(prox,opt,timeoutMs); return await r.json(); }
    catch(e){ dlog('proxy failed ->', prox, e.message||e); }
  }
  throw new Error('All routes failed');
}

async function fetchWithTimeout(url, opt={}, ms=9000){
  const ctrl=new AbortController(); const t=setTimeout(()=>ctrl.abort(), ms);
  try{
    const r=await fetch(url,{...opt,signal:ctrl.signal});
    if(!r.ok) throw new Error(`HTTP ${r.status}`);
    return r;
  } finally { clearTimeout(t); }
}

/* ---------- Normalizers ---------- */
function nCG(c){ return { id:c.id,name:c.name,symbol:(c.symbol||'').toUpperCase(), price:c.current_price, cap:c.market_cap, pct24:c.price_change_percentage_24h, img:c.image, link:`https://www.coingecko.com/en/coins/${c.id}` }; }
function nCP(c){ const q=c.quotes?.USD||{}; return { id:c.id,name:c.name,symbol:(c.symbol||'').toUpperCase(), price:q.price, cap:q.market_cap, pct24:q.percent_change_24h, img:'', link:`https://coinpaprika.com/coin/${c.id}/` }; }
function nCC(a){ return { id:a.id,name:a.name,symbol:(a.symbol||'').toUpperCase(), price:Number(a.priceUsd), cap:Number(a.marketCapUsd), pct24:Number(a.changePercent24Hr), img:'', link:`https://coincap.io/assets/${a.id}` }; }

/* ---------- Providers (via CORSâ€‘safe getJSON) ---------- */
// CoinGecko (use if key present)
async function cgMarkets(params){
  const key=getCgKey(); const headers = key? {'x-cg-demo-api-key': key} : {};
  const q=new URLSearchParams({
    vs_currency:'usd', order: params.order||'market_cap_desc',
    per_page:String(params.per_page||250), page:String(params.page||1),
    price_change_percentage:'24h', sparkline:'false'
  });
  const url=`https://api.coingecko.com/api/v3/coins/markets?${q}`;
  dlog('CG GET', url, key?'(keyed)':'(keyless)');
  const j = await getJSON(url, { headers }, 9000);
  return (j||[]).map(nCG);
}

// CoinPaprika
async function cpTickers(){
  const url='https://api.coinpaprika.com/v1/tickers?quotes=USD';
  dlog('CP GET', url);
  const j = await getJSON(url, {}, 10000);
  return (j||[]).map(nCP);
}

// CoinCap (very browserâ€‘friendly)
async function ccAssets(limit=2000){
  const url=`https://api.coincap.io/v2/assets?limit=${limit}`;
  dlog('CC GET', url);
  const j = await getJSON(url, {}, 10000);
  return (j.data||[]).map(nCC);
}

/* ---------- Loaders (independent) ---------- */
const CAP_MAX=50_000_000;

async function loadMajors(){
  const b1=document.getElementById('majors-src1'), b2=document.getElementById('majors-src2');
  b1.textContent=b2.textContent='loadingâ€¦'; b1.className=b2.className='chip';
  try{
    let majors=[];
    if(getCgKey()){
      try{ majors=(await cgMarkets({order:'market_cap_desc', per_page:100, page:1})).slice(0,100); b1.textContent=b2.textContent='CoinGecko'; b1.classList.add('ok'); b2.classList.add('ok'); }
      catch(e){ dlog('CG majors failed ->', e.message||e); }
    }
    if(!majors.length){
      try{ const cc=await ccAssets(2000); majors=cc.filter(x=>x.cap>0).sort((a,b)=>b.cap-a.cap).slice(0,100); b1.textContent=b2.textContent='CoinCap'; b1.classList.add('ok'); b2.classList.add('ok'); }
      catch(e){ dlog('CC majors failed ->', e.message||e); }
    }
    if(!majors.length){
      const cp=await cpTickers(); majors=cp.filter(x=>x.cap>0).sort((a,b)=>b.cap-a.cap).slice(0,100);
      b1.textContent=b2.textContent='CoinPaprika'; b1.classList.add('ok'); b2.classList.add('ok');
    }
    cache.majors=majors;
    renderList('majors-gainers', [...majors].sort(byDesc).slice(0,15));
    renderList('majors-losers',  [...majors].sort(byAsc).slice(0,15));
  }catch(e){ dlog('Majors loader error:', e.message||e); b1.textContent=b2.textContent='error'; b1.classList.add('err'); b2.classList.add('err'); }
  finally{ document.getElementById('updated').textContent='Last updated: '+new Date().toLocaleTimeString(); }
}

async function loadMicro(){
  const b1=document.getElementById('micro-src1'), b2=document.getElementById('micro-src2');
  b1.textContent=b2.textContent='loadingâ€¦'; b1.className=b2.className='chip';
  try{
    let micro=[];
    // 1) CoinCap first (single list â†’ filter < $50M)
    try{ const cc=await ccAssets(2000); micro=cc.filter(x=>x.cap>0 && x.cap<CAP_MAX && x.price>0); b1.textContent=b2.textContent='CoinCap'; b1.classList.add('ok'); b2.classList.add('ok'); }
    catch(e){ dlog('CC micro failed ->', e.message||e); }

    // 2) If empty, CoinGecko (only when key or as a last resort)
    if(!micro.length){
      try{
        const asc1=await cgMarkets({order:'market_cap_asc', per_page:250, page:1});
        micro=asc1.filter(x=>x.cap>0 && x.cap<CAP_MAX && x.price>0);
        if(micro.length<15){
          const asc2=await cgMarkets({order:'market_cap_asc', per_page:250, page:2});
          micro=micro.concat(asc2.filter(x=>x.cap>0 && x.cap<CAP_MAX && x.price>0));
        }
        if(micro.length){ b1.textContent=b2.textContent='CoinGecko'; b1.classList.add('ok'); b2.classList.add('ok'); }
      }catch(e){ dlog('CG micro failed ->', e.message||e); }
    }

    // 3) If still empty, CoinPaprika
    if(!micro.length){
      const cp=await cpTickers(); micro=cp.filter(x=>x.cap>0 && x.cap<CAP_MAX && x.price>0);
      b1.textContent=b2.textContent='CoinPaprika'; b1.classList.add('ok'); b2.classList.add('ok');
    }

    cache.micro=micro;
    renderList('micro-gainers', [...micro].sort(byDesc).slice(0,15));
    renderList('micro-losers',  [...micro].sort(byAsc).slice(0,15));
  }catch(e){ dlog('Microcaps loader error:', e.message||e); b1.textContent=b2.textContent='error'; b1.classList.add('err'); b2.classList.add('err'); }
  finally{ document.getElementById('updated').textContent='Last updated: '+new Date().toLocaleTimeString(); }
}

/* ---------- Init + refresh ---------- */
function initLoad(){ loadMajors(); loadMicro(); }
document.getElementById('refreshBtn').onclick=initLoad;
initLoad(); setInterval(initLoad, 60_000);
</script>
</body>
</html>
