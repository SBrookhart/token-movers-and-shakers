
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Token Movers â€” Microcaps & Majors</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="Daily token movers: top gainers and losers among tiny microcaps (<$50M) and major players (Topâ€‘100). Includes methodology and data source notes." />
<style>
  :root {
    --bg:#0b0f14; --card:#111827; --border:#1f2937; --text:#e5e7eb; --muted:#94a3b8;
    --green:#22c55e; --red:#ef4444; --accent:#243041; --tab:#0f1620; --yellow:#fbbf24;
  }
  * { box-sizing: border-box; }
  body { background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; padding:22px; }
  h1 { text-align:center; margin:0 0 6px; }
  .meta { text-align:center; color:var(--muted); margin-bottom:12px; }
  .topbar { max-width:1100px; margin:0 auto 12px; display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:center; }
  .topbar input { background:#0f1620; color:#e5e7eb; border:1px solid #1f2937; border-radius:8px; padding:6px 10px; min-width:260px; }
  .topbar button { background:#1f2937; color:var(--text); border:1px solid var(--border); padding:6px 10px; border-radius:8px; cursor:pointer; }
  .topbar button:hover { background:var(--accent); }
  .banner { max-width:1100px; margin:0 auto 14px; background:#0f1620; border:1px solid var(--border); border-radius:10px; padding:10px 12px; color:#d1d5db; }
  .banner p { margin:6px 0; }
  .tabs { max-width:1100px; margin:0 auto 10px; display:flex; gap:8px; }
  .tab { background:var(--tab); border:1px solid var(--border); color:#cbd5e1; padding:8px 12px; border-radius:10px; cursor:pointer; }
  .tab.active { background:#1a2230; color:#fff; border-color:#2b3a51; }
  .panel { display:none; }
  .panel.active { display:block; }
  .two { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:10px; }
  .card { background:var(--card); border:1px solid var(--border); padding:12px; border-radius:12px; }
  .card h3 { margin:4px 0 10px; }
  .list { display:grid; gap:6px; }
  .row { display:grid; grid-template-columns:24px 1fr 100px 120px 90px; gap:8px; align-items:center; padding:8px; border:1px solid #1f2937; border-radius:8px; background:#0f1620; }
  .row img { width:24px; height:24px; border-radius:50%; display:block; }
  .row .name { display:flex; gap:6px; align-items:baseline; }
  .row .name a { color:#e5e7eb; text-decoration:none; }
  .row .name a:hover { text-decoration:underline; }
  .row .name .sym { color:#9ca3af; font-size:.9rem; }
  .chg { font-weight:600; text-align:right; }
  .pos { color:var(--green); } .neg { color:var(--red); }
  .toolbar { display:flex; gap:8px; margin-top:6px; align-items:center; }
  .search { flex:1; }
  details { background:#0f1620; border:1px solid var(--border); border-radius:10px; padding:10px 12px; max-width:1100px; margin:14px auto; }
  details summary { cursor:pointer; font-weight:600; }
  .muted { color:var(--muted); }
  .refs a { color:#93c5fd; text-decoration:underline; }
  details.debug { max-width:1100px; margin:14px auto; background:#0f1620; border:1px solid var(--border); border-radius:10px; padding:8px 12px; }
  .log { white-space:pre-wrap; font-family:ui-monospace, Menlo, Consolas, monospace; font-size:12px; color:#cbd5e1; max-height:220px; overflow:auto; background:#0b1119; border:1px solid #1f2937; border-radius:8px; padding:8px; }
  @media (max-width: 760px) {
    .two { grid-template-columns:1fr; }
    .row { grid-template-columns:24px 1fr 90px 100px 80px; }
  }
</style>
</head>
<body>
  <h1>ðŸ“ˆ Token Movers â€” Microcaps & Majors</h1>
  <div class="meta">
    <span id="updated">Loadingâ€¦</span> Â· Autoâ€‘refresh every 60s Â·
    <button id="refreshBtn">Refresh</button>
  </div>

  <!-- WHAT YOUâ€™RE SEEING -->
  <div class="banner" id="about">
    <h2 style="margin:0 0 6px">What youâ€™re seeing</h2>
    <p>
      This page shows the dayâ€™s <strong>top gainers and losers</strong> by <em>24â€‘hour price change (%)</em> for two groups:
      <strong>Tiny Microcaps</strong> (market cap &lt; <strong>$50M</strong>) and <strong>Major Players</strong> (Topâ€‘100 by market cap).
      Use the search box to filter by name or symbol. Data refreshes every minute.
    </p>
    <p class="muted">
      Numbers are sourced from public market data aggregators; thinâ€‘liquidity microcaps can be volatile or noisy.
      Always check liquidity and listings before acting.
    </p>
  </div>

  <!-- Controls -->
  <div class="topbar">
    <input id="search" class="search" type="text" placeholder="Search name or symbolâ€¦" />
    <input id="cgKey" type="password" placeholder="(Optional) CoinGecko Demo API key" />
    <button id="saveKey">Save key</button>
    <button id="clearKey">Clear key</button>
    <span id="keyStatus" style="color:var(--yellow);"></span>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <div class="tab active" data-tab="micro">Microcaps (&lt;$50M)</div>
    <div class="tab" data-tab="majors">Major Players (Topâ€‘100)</div>
  </div>

  <!-- Microcaps Panel -->
  <div id="panel-micro" class="panel active">
    <div class="two">
      <div class="card">
        <h3>Top 15 Gainers (24h)</h3>
        <div id="micro-gainers" class="list"></div>
      </div>
      <div class="card">
        <h3>Top 15 Losers (24h)</h3>
        <div id="micro-losers" class="list"></div>
      </div>
    </div>
  </div>

  <!-- Majors Panel -->
  <div id="panel-majors" class="panel">
    <div class="two">
      <div class="card">
        <h3>Top 15 Gainers (24h)</h3>
        <div id="majors-gainers" class="list"></div>
      </div>
      <div class="card">
        <h3>Top 15 Losers (24h)</h3>
        <div id="majors-losers" class="list"></div>
      </div>
    </div>
  </div>

  <!-- Methodology & Data Sources -->
  <details open>
    <summary>ðŸ“š Methodology & Data Sources</summary>
    <div style="margin-top:8px; line-height:1.5">
      <ol>
        <li>
          <strong>Universe & segmentation.</strong>
          <ul>
            <li><em>Tiny Microcaps</em>: tokens with reported <strong>market cap &lt; $50,000,000</strong>.</li>
            <li><em>Major Players</em>: the <strong>Topâ€‘100</strong> tokens by market cap.</li>
          </ul>
        </li>
        <li>
          <strong>Primary data source (CoinGecko).</strong>
          We pull paged market snapshots from CoinGeckoâ€™s
          <code>/api/v3/coins/markets</code> endpoint (price, market cap, 24h % change, logo).
          Optional Demo API key improves rateâ€‘limit stability (~30 calls/min) â€” passed via the
          <code>x-cg-demo-api-key</code> header. <span class="refs">
          Docs: https://docs.coingecko.com/v3.0.1/reference/coins-markets</a>,
          Rate limits: https://docs.coingecko.com/docs/common-errors-rate-limit</a></span>.
        </li>
        <li>
          <strong>Fallback (CoinPaprika).</strong>
          If CoinGecko is rateâ€‘limited/unavailable or returns too few microcaps, we query CoinPaprika
          <code>/v1/tickers?quotes=USD</code> and compute the same lists clientâ€‘side.
          <span class="refs">Docs: https://docs.coinpaprika.com/</a></span>.
        </li>
        <li>
          <strong>Computation.</strong>
          We filter out entries with missing cap or nonâ€‘positive price, deâ€‘duplicate by id,
          compute gainers/losers by sorting on <em>24h % change</em>, and show the top 15 in each list.
        </li>
        <li>
          <strong>Refresh & limits.</strong>
          Autoâ€‘refresh is set to <strong>60 seconds</strong> to respect public API limits. Your Demo key (if supplied) is stored
          only in your browser (LocalStorage), not in this site or repo.
        </li>
        <li>
          <strong>Known caveats.</strong>
          Smallâ€‘cap data can be noisy (low liquidity, exchange coverage). Values are snapshots and may differ from
          exchange UIs. Always crossâ€‘check before acting.
        </li>
      </ol>
    </div>
  </details>

  <details class="debug">
    <summary>ðŸ›  Debug (optional)</summary>
    <div class="log" id="debugLog">No logs yet.</div>
    <div style="margin-top:6px;color:#9ca3af;font-size:12px">
      Primary: CoinGecko <code>/coins/markets</code> (Demo key optional). Fallback: CoinPaprika <code>/v1/tickers?quotes=USD</code>.
    </div>
  </details>

<script>
/* ======= debug logger ======= */
const dlogEl = document.getElementById('debugLog');
function dlog(...a){ dlogEl.textContent += `\n${new Date().toLocaleTimeString()}  ${a.map(x=>typeof x==='object'?JSON.stringify(x):String(x)).join(' ')}`; dlogEl.scrollTop = dlogEl.scrollHeight; }

/* ======= tabs ======= */
document.querySelectorAll('.tab').forEach(t=>{
  t.addEventListener('click',()=> {
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.panel').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    document.getElementById('panel-'+t.dataset.tab).classList.add('active');
  });
});

/* ======= key storage + URL capture ======= */
const LS_KEY = 'CG_DEMO_KEY';
const keyInput = document.getElementById('cgKey');
const keyStatus = document.getElementById('keyStatus');
function getCgKey(){ return (localStorage.getItem(LS_KEY)||'').trim(); }
function maskKey(k){ return k? k.slice(0,4)+'â€¢â€¢â€¢'+k.slice(-2):'';}
function updateKeyUI(){ const k=getCgKey(); keyStatus.textContent = k? `CoinGecko key saved (${maskKey(k)})` : 'No CoinGecko key (fallback enabled)'; }
(function captureKey(){
  const p = new URLSearchParams(location.search);
  const ck = (p.get('ck')||'').trim();
  if(ck && ck.length>10){ localStorage.setItem(LS_KEY, ck); history.replaceState({},'',location.pathname); dlog('Captured CG key from URL param:', maskKey(ck)); }
})();
updateKeyUI();
document.getElementById('saveKey').onclick=()=>{ const k=keyInput.value.trim(); if(!k){alert('Paste your CoinGecko Demo key first'); return;} localStorage.setItem(LS_KEY,k); keyInput.value=''; updateKeyUI(); loadAll(); };
document.getElementById('clearKey').onclick=()=>{ localStorage.removeItem(LS_KEY); updateKeyUI(); loadAll(); };

/* ======= search filter ======= */
const searchInput = document.getElementById('search');
let lastData = { micro:[], majors:[] };
searchInput.addEventListener('input', ()=> renderAll(lastData));

/* ======= helpers ======= */
function fmtUSD(x){ if(x==null) return 'â€”'; if(x>=1) return '$'+x.toLocaleString(undefined,{maximumFractionDigits:2}); return '$'+x.toFixed(6); }
function fmtCap(x){ if(!x&&x!==0) return 'â€”'; if(x>=1e9) return '$'+(x/1e9).toFixed(2)+'B'; if(x>=1e6) return '$'+(x/1e6).toFixed(2)+'M'; return '$'+Math.round(x).toLocaleString(); }
function byChangeDesc(a,b){ return (b.pct24??-Infinity)-(a.pct24??-Infinity); }
function byChangeAsc(a,b){ return (a.pct24??Infinity)-(b.pct24??Infinity); }
function normalizeCgCoin(c){
  return {
    id:c.id, name:c.name, symbol:(c.symbol||'').toUpperCase(),
    price:c.current_price, cap:c.market_cap, pct24:c.price_change_percentage_24h,
    img:c.image, link:`https://www.coingecko.com/en/coins/${c.id}`
  };
}
function normalizeCpCoin(c){
  const q = c.quotes?.USD || {};
  return {
    id:c.id, name:c.name, symbol:(c.symbol||'').toUpperCase(),
    price:q.price, cap:q.market_cap, pct24:q.percent_change_24h,
    img:'', link:`https://coinpaprika.com/coin/${c.id}/`
  };
}

/* ======= proper row rendering (fixes) ======= */
function renderList(rootId, rows){
  const q = (searchInput.value||'').trim().toLowerCase();
  const filtered = q? rows.filter(c => c.name.toLowerCase().includes(q) || c.symbol.toLowerCase().includes(q)) : rows;
  const root = document.getElementById(rootId);
  root.innerHTML = filtered.map(c => `
    <div class="row">
      <div>${c.img ? `<img src="${c.img}" alt="${c.symbol}">` : 'ðŸª™'}</div>
      <div class="name">
        <a href="${c.link}" target="_blank" rel="noopener noreferrer">${c.name}</a>
        <span class="sym">${c.symbol}</span>
      </div>
      <div>${fmtUSD(c.price)}</div>
      <div>${fmtCap(c.cap)}</div>
      <div class="chg ${c.pct24>=0?'pos':'neg'}">${(c.pct24??0).toFixed(2)}%</div>
    </div>
  `).join('');
}

function renderAll(data){
  lastData = data;
  renderList('micro-gainers', [...data.micro].sort(byChangeDesc).slice(0,15));
  renderList('micro-losers',  [...data.micro].sort(byChangeAsc).slice(0,15));
  renderList('majors-gainers', [...data.majors].sort(byChangeDesc).slice(0,15));
  renderList('majors-losers',  [...data.majors].sort(byChangeAsc).slice(0,15));
}

/* ======= fetch utilities & sources ======= */
async function fetchWithTimeout(url, options={}, timeoutMs=8000){
  const ctrl = new AbortController();
  const id = setTimeout(()=>ctrl.abort(), timeoutMs);
  try {
    const r = await fetch(url, { ...options, signal: ctrl.signal });
    if (!r.ok) throw new Error(`HTTP ${r.status}`);
    return r;
  } finally { clearTimeout(id); }
}
async function cgMarkets(params, pages=1){
  const key=getCgKey();
  const base='https://api.coingecko.com/api/v3/coins/markets';
  const headers = key? {'x-cg-demo-api-key': key} : {};
  let all=[];
  for(let p=1;p<=pages;p++){
    const q = new URLSearchParams({
      vs_currency:'usd',
      order: params.order||'market_cap_desc',
      per_page: String(params.per_page||250),
      page: String(p),
      price_change_percentage:'24h',
      sparkline:'false'
    });
    const url=`${base}?${q.toString()}`;
    dlog('CG GET', url, key?'(keyed)':'(keyless)');
    const r = await fetchWithTimeout(url, {headers}, 8000);
    const j = await r.json();
    all = all.concat(j.map(normalizeCgCoin));
    await new Promise(res=>setTimeout(res, 150)); // be gentle
  }
  return all;
}
async function cpTickers(){
  const url='https://api.coinpaprika.com/v1/tickers?quotes=USD';
  dlog('CP GET', url);
  const r = await fetchWithTimeout(url, {}, 10000);
  const j = await r.json();
  return j.map(normalizeCpCoin);
}

const CAP_MAX_MICRO = 50_000_000;

/* ======= more robust microcaps loader ======= */
async function loadMicrocaps(){
  // Try CoinGecko: smallest caps first; pull up to 4 pages (1000 rows).
  try{
    const pagesToTry = 4;
    const all = await cgMarkets({ order:'market_cap_asc', per_page:250 }, pagesToTry);
    let micro = all.filter(c=> c.cap && c.cap < CAP_MAX_MICRO && c.price>0);
    dlog('Microcaps from CG:', micro.length);
    // If we still donâ€™t have enough (there are many null caps in ASC), fallback to CP.
    if (micro.length < 10) {
      dlog('Microcaps: CG yielded few rows; switching to CoinPaprika fallbackâ€¦');
      const cpAll = await cpTickers();
      micro = cpAll.filter(c=> c.cap && c.cap < CAP_MAX_MICRO && c.price>0);
      dlog('Microcaps from CP:', micro.length);
    }
    return micro;
  } catch(e){
    dlog('CG micro failed ->', e.message||e);
    const all = await cpTickers();
    const micro = all.filter(c=> c.cap && c.cap < CAP_MAX_MICRO && c.price>0);
    dlog('Microcaps from CP:', micro.length);
    return micro;
  }
}

async function loadMajors(){
  try{
    const top = await cgMarkets({ order:'market_cap_desc', per_page:100 }, 1);
    dlog('Majors from CG:', top.length);
    return top;
  } catch(e){
    dlog('CG majors failed ->', e.message||e);
    const all = await cpTickers();
    const sorted = all.filter(c=>c.cap).sort((a,b)=>b.cap-a.cap).slice(0,100);
    dlog('Majors from CP:', sorted.length);
    return sorted;
  }
}

async function loadAll(){
  document.getElementById('updated').textContent = 'Loadingâ€¦';
  try{
    const [micro, majors] = await Promise.all([loadMicrocaps(), loadMajors()]);
    renderAll({ micro, majors });
    document.getElementById('updated').textContent = 'Last updated: ' + new Date().toLocaleTimeString();
  } catch(e){
    dlog('loadAll error:', e.message||e);
    document.getElementById('updated').textContent = 'Error loading data (see Debug)';
  }
}
document.getElementById('refreshBtn').onclick = loadAll;
loadAll();
setInterval(loadAll, 60_000);
</script>
</body>
</html>
``
