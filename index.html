
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Token Movers â€” Microcaps & Majors</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="Daily token movers: gainers/losers across microcaps (<$50M) & majors (Topâ€‘100), with categories and 7â€‘day sparklines. Served via a Cloudflare Worker." />
<style>
  :root { --bg:#0b0f14; --card:#111827; --border:#1f2937; --text:#e5e7eb; --muted:#94a3b8; --green:#22c55e; --red:#ef4444; --accent:#243041; --tab:#0f1620; --chip:#0e1724; --chip-ok:#113e22; --chip-err:#5a1313; }
  *{box-sizing:border-box}
  body{background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;padding:22px;}
  h1{text-align:center;margin:0 0 6px;}
  .meta{text-align:center;color:var(--muted);margin-bottom:12px;}
  .topbar{max-width:1100px;margin:0 auto 12px;display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:center;}
  .topbar input,.topbar select{background:#0f1620;color:#e5e7eb;border:1px solid #1f2937;border-radius:8px;padding:6px 10px;}
  .tabs{max-width:1100px;margin:0 auto 10px;display:flex;gap:8px;}
  .tab{background:var(--tab);border:1px solid var(--border);color:#cbd5e1;padding:8px 12px;border-radius:10px;cursor:pointer;}
  .tab.active{background:#1a2230;color:#fff;border-color:#2b3a51;}
  .panel{display:none}.panel.active{display:block}
  .two{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px;}
  .card{background:var(--card);border:1px solid var(--border);padding:12px;border-radius:12px;}
  .card h3{margin:4px 0 10px;display:flex;align-items:center;gap:10px;}
  .chip{font-size:.75rem;background:var(--chip);border:1px solid #22324a;color:#cbd5e1;padding:2px 8px;border-radius:999px;}
  .chip.ok{background:var(--chip-ok);border-color:#1d6830;color:#d1fae5}
  .list{display:grid;gap:6px;}
  .row{display:grid;grid-template-columns:24px 1fr 100px 120px 90px 90px;gap:8px;align-items:center;padding:8px;border:1px solid #1f2937;border-radius:8px;background:#0f1620;}
  .row img{width:24px;height:24px;border-radius:50%;}
  .row .name{display:flex;gap:6px;align-items:baseline}
  .row .name a{color:#e5e7eb;text-decoration:none}.row .name a:hover{text-decoration:underline}
  .row .name .sym{color:#9ca3af;font-size:.9rem}
  .chg{font-weight:600;text-align:right}
  canvas.spark{width:90px;height:24px}
  details{background:#0f1620;border:1px solid var(--border);border-radius:10px;padding:10px 12px;max-width:1100px;margin:14px auto;}
  details summary{cursor:pointer;font-weight:600}
  .muted{color:#94a3b8}
  .footer{max-width:1100px;margin:18px auto 0;color:#9ca3af;font-size:12px;display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
  .footer a{color:#93c5fd}
  @media (max-width:760px){.two{grid-template-columns:1fr}.row{grid-template-columns:24px 1fr 90px 100px 80px 80px}}
</style>
</head>
<body>
  <h1>ðŸ“ˆ Token Movers â€” Microcaps & Majors</h1>
  <div class="meta">
    <span id="updated">Loadingâ€¦</span> Â· Autoâ€‘refresh every 60s Â· <button id="refreshBtn">Refresh</button>
  </div>

  <div class="topbar">
    <input id="search" type="text" placeholder="Search name or symbolâ€¦" />
    <label for="cat">Category:</label>
    <select id="cat" title="CoinGecko categories">
      <option value="all" selected>All</option>
      <option value="ai-big-data">AI & Big Data</option>
      <option value="decentralized-finance-defi">DeFi</option>
      <option value="meme-token">Meme</option>
    </select>
  </div>

  <div class="tabs">
    <div class="tab active" data-tab="micro">Microcaps (&lt;$50M)</div>
    <div class="tab" data-tab="majors">Major Players (Topâ€‘100)</div>
  </div>

  <!-- Microcaps -->
  <div id="panel-micro" class="panel active">
    <div class="two">
      <div class="card">
        <h3>Top 15 Gainers (24h) <span id="micro-src1" class="chip">loadingâ€¦</span></h3>
        <div id="micro-gainers" class="list"></div>
      </div>
      <div class="card">
        <h3>Top 15 Losers (24h) <span id="micro-src2" class="chip">loadingâ€¦</span></h3>
        <div id="micro-losers" class="list"></div>
      </div>
    </div>
  </div>

  <!-- Majors -->
  <div id="panel-majors" class="panel">
    <div class="two">
      <div class="card">
        <h3>Top 15 Gainers (24h) <span id="majors-src1" class="chip">loadingâ€¦</span></h3>
        <div id="majors-gainers" class="list"></div>
      </div>
      <div class="card">
        <h3>Top 15 Losers (24h) <span id="majors-src2" class="chip">loadingâ€¦</span></h3>
        <div id="majors-losers" class="list"></div>
      </div>
    </div>
  </div>

  <details open>
    <summary>ðŸ“š Methodology & Notes</summary>
    <div class="muted" style="margin-top:8px;line-height:1.5">
      <ul>
        <li><strong>Segments:</strong> Microcaps = market cap &lt; $50M; Majors = Topâ€‘100 by market cap.</li>
        <li><strong>Category filter:</strong> Uses CoinGeckoâ€™s <code>category</code> parameter in <code>/coins/markets</code>. [1](https://askai.glarity.app/search/What-are-the-rate-limits-for-the-CoinGecko-API)</li>
        <li><strong>Sparklines:</strong> 7â€‘day arrays from <code>sparkline=true</code> on the same endpoint; rendered as tiny canvases. [1](https://askai.glarity.app/search/What-are-the-rate-limits-for-the-CoinGecko-API)</li>
        <li><strong>Data path:</strong> Browser â†’ Worker (CORSâ€‘safe) â†’ CoinCap / CoinPaprika / CoinGecko; 60s edge cache keeps calls light. [4](https://docs.polygon.technology/tools/gas/polygon-gas-station/)[5](https://docs.base.org/base-account/reference/core/provider-rpc-methods/eth_gasPrice)</li>
      </ul>
    </div>
  </details>

  <details class="debug"><summary>ðŸ›  Debug</summary><pre id="debugLog" class="log">No logs yet.</pre></details>

  <div class="footer">
    <div>Data via <a href="https://api.coincap.io" target="_blank" rel="noopener">CoinCap</a>, <a href="https://api.coinpaprika.com" target="_blank" rel="noopener">CoinPaprika</a>, <a href="https://www.coingecko.com/en/api" target="_blank" rel="noopener">CoinGecko</a>.</div>
    <div id="teamSig">Â© 2026 <span id="teamName">Your team name here</span></div>
  </div>

<script>
/* ====== CONFIG ====== */
const WORKER_BASE = 'https://movers-proxy.sabina-brookhart.workers.dev';
const TEAM_NAME = '<< set your team name >>';  // e.g., 'Workflow & Process Reautomation Squad'

/* ====== Debug logger ====== */
const LOG=document.getElementById('debugLog');
function dlog(...a){ LOG.textContent += `\n${new Date().toLocaleTimeString()}  ${a.map(x=>typeof x==='object'?JSON.stringify(x):String(x)).join(' ')}`; LOG.scrollTop=LOG.scrollHeight; }

/* ====== Tabs ====== */
document.querySelectorAll('.tab').forEach(t=>{
  t.addEventListener('click',()=>{ document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active')); document.querySelectorAll('.panel').forEach(x=>x.classList.remove('active')); t.classList.add('active'); document.getElementById('panel-'+t.dataset.tab).classList.add('active'); });
});

/* ====== Search & Category ====== */
const searchInput=document.getElementById('search');
const catSelect=document.getElementById('cat');
let cache={ micro:[], majors:[], microGainers:null, microLosers:null, majorsGainers:null, majorsLosers:null };

searchInput.addEventListener('input', ()=> renderAll(cache));
catSelect.addEventListener('change', ()=> initLoad());

/* ====== Helpers ====== */
function fmtUSD(x){ if(x==null) return 'â€”'; const n=Number(x); return n>=1? '$'+n.toLocaleString(undefined,{maximumFractionDigits:2}) : '$'+n.toFixed(6); }
function fmtCap(x){ if(x==null) return 'â€”'; const n=Number(x); if(n>=1e9) return '$'+(n/1e9).toFixed(2)+'B'; if(n>=1e6) return '$'+(n/1e6).toFixed(2)+'M'; return '$'+Math.round(n).toLocaleString(); }
function byDesc(a,b){ return (b.pct24??-Infinity)-(a.pct24??-Infinity); }
function byAsc(a,b){ return (a.pct24??Infinity)-(b.pct24??Infinity); }
function esc(s){ return String(s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

/* ====== Tiny sparkline (90x24) ====== */
function drawSpark(canvas, arr, isUp){
  if(!canvas || !Array.isArray(arr) || arr.length<8){ return; }
  const w=canvas.width=90, h=canvas.height=24, min=Math.min(...arr), max=Math.max(...arr), span=(max-min)||1;
  const y=v=>h-((v-min)/span)*h; const ctx=canvas.getContext('2d'); ctx.clearRect(0,0,w,h);
  ctx.strokeStyle=isUp?'#22c55e':'#ef4444'; ctx.lineWidth=1.5; ctx.beginPath();
  for(let i=0;i<arr.length;i++){ const xx=(i/(arr.length-1))*w, yy=y(arr[i]); i?ctx.lineTo(xx,yy):ctx.moveTo(xx,yy); }
  ctx.stroke();
}

/* ====== Row rendering ====== */
function rowHTML(c){
  const up=(c.pct24??0)>=0;
  return `
    <div class="row">
      <div>${c.img ? `${esc(c.img)}` : 'ðŸª™'}</div>
      <div class="name">${esc(c.link)}${esc(c.name)}</a> <span class="sym">${esc(c.symbol)}</span></div>
      <div>${fmtUSD(c.price)}</div>
      <div>${fmtCap(c.cap)}</div>
      <div class="chg ${up?'pos':'neg'}">${(c.pct24??0).toFixed(2)}%</div>
      <canvas class="spark" width="90" height="24" data-has="${Array.isArray(c.spark)?1:0}"></canvas>
    </div>`;
}
function renderList(id, rows){
  const q=(searchInput.value||'').trim().toLowerCase();
  const f=q? rows.filter(x=>x.name.toLowerCase().includes(q)||x.symbol.toLowerCase().includes(q)) : rows;
  const root=document.getElementById(id);
  root.innerHTML=f.map(rowHTML).join('');
  // draw sparklines
  const cvs=root.querySelectorAll('canvas.spark'); f.forEach((c,i)=>{ if(Array.isArray(c.spark)) drawSpark(cvs[i], c.spark, (c.pct24??0)>=0); });
}
function renderAll(d){
  renderList('micro-gainers', d.microGainers || [...d.micro].sort(byDesc).slice(0,15));
  renderList('micro-losers',  d.microLosers  || [...d.micro].sort(byAsc).slice(0,15));
  renderList('majors-gainers', d.majorsGainers || [...d.majors].sort(byDesc).slice(0,15));
  renderList('majors-losers',  d.majorsLosers  || [...d.majors].sort(byAsc).slice(0,15));
}

/* ====== Fetch from Worker ====== */
async function initLoad(){
  document.getElementById('updated').textContent='Loadingâ€¦';
  const cat = catSelect.value || 'all';
  try{
    const [maj, mic] = await Promise.all([
      fetch(`${WORKER_BASE}/movers/majors?category=${encodeURIComponent(cat)}`).then(r=>r.json()),
      fetch(`${WORKER_BASE}/movers/micro?category=${encodeURIComponent(cat)}`).then(r=>r.json())
    ]);
    cache.majors = maj.items || []; cache.micro = mic.items || [];
    cache.majorsGainers = maj.gainers || null; cache.majorsLosers = maj.losers || null;
    cache.microGainers  = mic.gainers || null;  cache.microLosers  = mic.losers || null;

    // source chips (you can swap to show maj.source/mic.source if desired)
    ['micro-src1','micro-src2','majors-src1','majors-src2'].forEach(id=>{ const el=document.getElementById(id); if(el){ el.textContent='Worker'; el.classList.add('ok'); } });

    renderAll(cache);
    document.getElementById('updated').textContent='Last updated: '+new Date().toLocaleTimeString();
  } catch(e){
    dlog('UI error:', e.message||e);
    document.getElementById('updated').textContent='Error (see Debug)';
  }
}

/* Init */
document.getElementById('teamName').textContent = TEAM_NAME;
document.getElementById('refreshBtn').onclick=initLoad;
initLoad(); setInterval(initLoad, 60_000);
</script>
</body>
</html>
